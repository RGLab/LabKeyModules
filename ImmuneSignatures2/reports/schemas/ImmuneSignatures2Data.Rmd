---
output: 
    html_document:
        self_contained: false
        df_print: paged
---

# The Immune Signatures Data Resource: A compendium of systems vaccinology datasets

Vaccines are among the most cost-effective public health interventions for preventing infection-induced morbidity and mortality, yet much remains to be learned regarding mechanisms. The NIH/NIAID Human Immunology Project Consortium(HIPC) has leveraged systems immunology approaches to identify molecular signatures of immunogenicity in many vaccines. These data are available to the scientific community through the ImmuneSpace data portal and analysis engine leveraging the NIH/NIAID ImmPort repository. However, a barrier to progress in this area is that comparative vaccine analyses have been limited by the distributed nature of some data, potential confounders, and the absence of relevant studies in ImmPort. To support comparative analysis, we have created the Immune Signatures Data Resource, a compendium of standardized systems vaccinology datasets available through ImmuneSpace, along with code to reproduce the standardization pipeline. The current release comprises 1405 participants from 53 cohorts profiling the response to 24 vaccines and includes transcriptional profiles and antibody response measurements. This novel compendium represents a valuable resource for comparative analyses that will accelerate our understanding of mechanisms underlying vaccine responses.

[Read the preprint](https://www.biorxiv.org/content/10.1101/2021.11.05.465336v1)

```{r setup, echo = FALSE}
suppressPackageStartupMessages({
  library(knitr)
  library(magrittr)
  library(data.table)
})
getFileUrl <- function(filepath) {
  sub("/share/files", "/_webdav", filepath)
}
getFileLink <- function(filepath, filename) {
  paste0("<a href=\"", getFileUrl(filepath), "\">", filename, "</a>")
}
```

## All Data

<a href="/_webdav/HIPC/IS2/@files/immunesignatures2.zip"><button>Download immunesignatures.zip (3.96 GB)</button></a> 

__DOI:__ _coming soon_

__Note:__ The ImmuneSignatures data resource is derived from publicly available data on ImmPort, and available for reuse under the ImmPort [data use agreement](https://www.immport.org/agreement). 



## Expression Sets


<div class="is2-downloads table-condensed">
```{r downloads, echo = FALSE}
files <- fread("/share/files/HIPC/IS2/@files/data/dataset_metadata.csv")
esets <- files[grepl("_eset\\.rds", dataset)]
eset_descriptions = c(
  all_noNorm_eset.rds = "All subjects, log2-normalized expression",
  all_noNorm_withResponse_eset.rds = "All subjects with immune response data, log2-normalized expression",
  all_norm_eset.rds = "All subjects, cross-study normalized and batch corrected expression",
  all_norm_withResponse_eset.rds = "All subjects with immune response data, cross-study normalized and batch corrected expression",
  young_noNorm_eset.rds = "Subjects age 18-50, log2-normalized expression",
  young_noNorm_withResponse_eset.rds = "Subjects age 18-50 with immune response data, log2-normalized expression",
  young_norm_eset.rds = "Subjects age 18-50, cross-study normalized and batch corrected expression", 
  young_norm_withResponse_eset.rds = "Subjects age 18-50 with immune response data, cross-study normalized and batch corrected expression",
  old_noNorm_eset.rds = "Subjects age 60-90, log2-normalized expression",
  old_noNorm_withResponse_eset.rds = "Subjects age 60-90 with immune response data, log2-normalized expression",
  old_norm_batchCorrectedFromYoung_eset.rds ="Subjects age 60-90, cross-study normalized and batch corrected using correction coefficients from young",
  old_norm_batchCorrectedFromYoung_withResponse_eset.rds = "Subjects age 60-90 with immune response data, cross-study normalized and batch corrected using correction coefficients from young",
  extendedOld_noNorm_eset.rds = "Subjects age 50-90, log2-normalized expression",
  extendedOld_noNorm_withResponse_eset.rds = "Subjects age 50-90 with immune response data, log2-normalized coutns",
  extendedOld_norm_batchCorrectedFromYoung_eset.rds = "Subjects age 50-90, log2-normalized counts",
  extendedOld_norm_batchCorrectedFromYoung_withResponse_eset.rds = "Subjects age 50-90 with immune response data, cross-study normalized and batch corrected using correction coefficients from young"
)
esets <- esets[, description := eset_descriptions[dataset]]

esets <- esets[, .(
  File = as.character(getFileLink(path, dataset)), 
  Description = as.character(description), 
  Participants = subjects, 
  Samples = samples, 
  Features = features
)]

knitr::kable(esets, escape = FALSE, format = "html")
```
</div>

### Other Datasets

<div class="is2-downloads table-condensed">
```{r immdata, echo = FALSE, warning=FALSE}
immdata<- files[dataset == "all_immdata_with_response.rds"]
immdata$description <- "Immune response data for all subjects where available. This dataset includes one entry per participant, with metadata and the derived immune response call."
immdata_tbl <- immdata[, .(
  File = as.character(getFileLink(path, dataset)),
  Description = as.character(description),
  Participants = subjects,
  Samples = samples
)]
knitr::kable(immdata_tbl, escape = FALSE, format = "html")
```
</div>

#### Preview

```{r immdata-preview, echo = FALSE}
immdata <- readRDS(immdata$path)
immdata
```

## Raw data
<a href="/study/HIPC/IS2/dataset.view?datasetId=5014">Gene expression data files</a>

### Immune Response Data
<a href="/study/HIPC/IS2/dataset.view?datasetId=5004">Enzyme-Linked ImmunoSpot (ELISPOT)</a><br>
<a href="/study/HIPC/IS2/dataset.view?datasetId=5005">Hemagglutination inhibition (HAI)</a><br>
<a href="/study/HIPC/IS2/dataset.view?datasetId=5009">Neutralizing antibody titer</a><br>

Immune Response Data for all assays is also available as an R object:

<a href="/_webdav/HIPC/IS2/@files/data/immdata_all.rds">immdata_all.rds</a><br>

---

## Code

Rmarkdown outputs from preprocessing, including code and some summaries. 
Preprocessing depends on the [ImmuneSignatures2](https://github.com/RGLab/ImmuneSignatures2) R package. (DOI: [10.5281/zenodo.5706261](https://zenodo.org/record/5706261#.YaVs1caIZQI))

1. [Pull Expressionsets](/_webdav/HIPC/IS2/%40files/data/html_outputs/pull_esets.html){target="_blank"} 
    * Pulls gene expression data from ImmuneSpace server, constructs expressionsets, 
    and saves output to an R object on disk. 
1. [Generate Base ExpressionSet](/_webdav/HIPC/IS2/%40files/data/html_outputs/generate_base_eset.html){target="_blank"}
    * Perform basic QC and filtering, and save output to one ExpressionSet. 
1. [Create Final ExpressionSets](/_webdav/HIPC/IS2/%40files/data/html_outputs/create_final_esets.html){target="_blank"}
    * Perform cross-study normalization and batch correction, and save the different 
    versions available in the table above. 

<style>


  .is2-downloads td, .is2-downloads th {
    border: 1px solid #ddd;
    padding: 3px;
  }
  .is2-downloads tr:nth-child(even){background-color: #f2f2f2;}
  .is2-downloads tr:hover {background-color: #ddd;}
  .is2-downloads th {
    background-color: #255c97;
    text-align: left;
    color: white;
    font-size: 15px;
    font-weight: bold;
    padding: 3px;
  }

</style>
